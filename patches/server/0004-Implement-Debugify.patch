From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: woobeen Jeon <woobeen0516@gmail.com>
Date: Sun, 1 Dec 2024 17:01:46 +0900
Subject: [PATCH] Implement Debugify


diff --git a/src/main/java/net/minecraft/server/level/ServerPlayer.java b/src/main/java/net/minecraft/server/level/ServerPlayer.java
index c396580a9cfd86ff261bed439bb4662ae88010b5..3f3dfc061eed5b72e7fe1ad60ea608a42b8a9086 100644
--- a/src/main/java/net/minecraft/server/level/ServerPlayer.java
+++ b/src/main/java/net/minecraft/server/level/ServerPlayer.java
@@ -2193,6 +2193,13 @@ public class ServerPlayer extends net.minecraft.world.entity.player.Player imple
             if (gameMode == GameType.SPECTATOR) {
                 this.removeEntitiesOnShoulder();
                 this.stopRiding();
+                // CubePie start - Implement Debugify
+                this.stopSleeping();
+                this.releaseUsingItem();
+                this.setTicksFrozen(0);
+                if(this.fishing != null)
+                    this.fishing.discard();
+                // CubePie end - Implement Debugify
                 EnchantmentHelper.stopLocationBasedEffects(this);
             } else {
                 this.setCamera(this);
diff --git a/src/main/java/net/minecraft/server/rcon/RconConsoleSource.java b/src/main/java/net/minecraft/server/rcon/RconConsoleSource.java
index a04cf04cb694237ec77b38fc576f0dfc9264a25a..19c846201ecd59a5c736ce307227405d70a34936 100644
--- a/src/main/java/net/minecraft/server/rcon/RconConsoleSource.java
+++ b/src/main/java/net/minecraft/server/rcon/RconConsoleSource.java
@@ -55,7 +55,7 @@ public class RconConsoleSource implements CommandSource {
 
     @Override
     public void sendSystemMessage(Component message) {
-        this.buffer.append(message.getString());
+        this.buffer.append(message.getString()).append(System.lineSeparator()); // CubePie - Implement Debugify
     }
 
     @Override
diff --git a/src/main/java/net/minecraft/world/entity/Entity.java b/src/main/java/net/minecraft/world/entity/Entity.java
index 9f68c0fda7f5526eb97619f1a35ed3b78d1b3751..b4b129b2e1097706c7f3695078ff1bd1ae3dbd09 100644
--- a/src/main/java/net/minecraft/world/entity/Entity.java
+++ b/src/main/java/net/minecraft/world/entity/Entity.java
@@ -43,11 +43,7 @@ import net.minecraft.core.RegistryAccess;
 import net.minecraft.core.SectionPos;
 import net.minecraft.core.particles.BlockParticleOption;
 import net.minecraft.core.particles.ParticleTypes;
-import net.minecraft.nbt.CompoundTag;
-import net.minecraft.nbt.DoubleTag;
-import net.minecraft.nbt.FloatTag;
-import net.minecraft.nbt.ListTag;
-import net.minecraft.nbt.StringTag;
+import net.minecraft.nbt.*;
 import net.minecraft.network.chat.ClickEvent;
 import net.minecraft.network.chat.Component;
 import net.minecraft.network.chat.HoverEvent;
@@ -2434,6 +2430,10 @@ public abstract class Entity implements SyncedDataHolder, Nameable, EntityAccess
 
             nbttagcompound.put("Rotation", this.newFloatList(this.getYRot(), this.getXRot()));
             nbttagcompound.putFloat("FallDistance", this.fallDistance);
+            // CubePie start - Implement Debugify
+            AABB aabb = this.getBoundingBox();
+            nbttagcompound.put("AABB", newDoubleList(aabb.minX, aabb.minY, aabb.minZ, aabb.maxX, aabb.maxY, aabb.maxZ));
+            // CubePie end - Implement Debugify
             nbttagcompound.putShort("Fire", (short) this.remainingFireTicks);
             nbttagcompound.putShort("Air", (short) this.getAirSupply());
             nbttagcompound.putBoolean("OnGround", this.onGround());
@@ -2602,6 +2602,19 @@ public abstract class Entity implements SyncedDataHolder, Nameable, EntityAccess
                 if (Double.isFinite((double) this.getYRot()) && Double.isFinite((double) this.getXRot())) {
                     this.reapplyPosition();
                     this.setRot(this.getYRot(), this.getXRot());
+                    // CubePie start - Implement Debugify
+                    if (nbt.contains("AABB")) {
+                        ListTag aabbNbt = nbt.getList("AABB", Tag.TAG_DOUBLE);
+                        this.setBoundingBox(new AABB(
+                            aabbNbt.getDouble(0),
+                            aabbNbt.getDouble(1),
+                            aabbNbt.getDouble(2),
+                            aabbNbt.getDouble(3),
+                            aabbNbt.getDouble(4),
+                            aabbNbt.getDouble(5)
+                        ));
+                    }
+                    // CubePie end - Implement Debugify
                     if (nbt.contains("CustomName", 8)) {
                         String s = nbt.getString("CustomName");
 
diff --git a/src/main/java/net/minecraft/world/entity/LivingEntity.java b/src/main/java/net/minecraft/world/entity/LivingEntity.java
index 30f4f1254fc295442d72d50479e8af635f2fe983..14cc1e80b7244fdc2e9cf3cfffa02492b47f2b81 100644
--- a/src/main/java/net/minecraft/world/entity/LivingEntity.java
+++ b/src/main/java/net/minecraft/world/entity/LivingEntity.java
@@ -89,10 +89,12 @@ import net.minecraft.world.entity.ai.attributes.AttributeSupplier;
 import net.minecraft.world.entity.ai.attributes.Attributes;
 import net.minecraft.world.entity.ai.attributes.DefaultAttributes;
 import net.minecraft.world.entity.ai.targeting.TargetingConditions;
+import net.minecraft.world.entity.animal.Chicken;
 import net.minecraft.world.entity.animal.FlyingAnimal;
 import net.minecraft.world.entity.animal.Wolf;
 import net.minecraft.world.entity.boss.wither.WitherBoss;
 import net.minecraft.world.entity.item.ItemEntity;
+import net.minecraft.world.entity.monster.Blaze;
 import net.minecraft.world.entity.projectile.AbstractArrow;
 import net.minecraft.world.entity.projectile.Projectile;
 import net.minecraft.world.food.FoodProperties;
@@ -377,7 +379,7 @@ public abstract class LivingEntity extends Entity implements Attackable {
                 this.onChangedBlock(worldserver, landedPosition);
                 double d1 = this.getAttributeValue(Attributes.SAFE_FALL_DISTANCE);
 
-                if ((double) this.fallDistance > d1 && !state.isAir()) {
+                if ((double) this.fallDistance > d1 && !(state.isAir() || this instanceof Chicken || this instanceof Blaze || this instanceof WitherBoss)) { // CubePie - Implement Debugify
                     double d2 = this.getX();
                     double d3 = this.getY();
                     double d4 = this.getZ();
diff --git a/src/main/java/net/minecraft/world/entity/Mob.java b/src/main/java/net/minecraft/world/entity/Mob.java
index 763abeea3f14f15c27d600e0bdae44b387687bb4..a085d1e741f6056abf57b390bc4f5175f7b5da01 100644
--- a/src/main/java/net/minecraft/world/entity/Mob.java
+++ b/src/main/java/net/minecraft/world/entity/Mob.java
@@ -372,6 +372,11 @@ public abstract class Mob extends LivingEntity implements EquipmentUser, Leashab
             this.playAmbientSound();
         }
 
+        // CubePie start - Implement Debugify
+        if (this.target != null && this.target.isDeadOrDying()) {
+            this.target = null;
+        }
+        // CubePie end - Implement Debugify
         this.level().getProfiler().pop();
     }
 
diff --git a/src/main/java/net/minecraft/world/entity/ai/goal/RangedBowAttackGoal.java b/src/main/java/net/minecraft/world/entity/ai/goal/RangedBowAttackGoal.java
index 515c1f671cb2c3a7cc23053aedf404bbbe77af3e..dda26a46f261264c05ced8c7d2cb2f993876744c 100644
--- a/src/main/java/net/minecraft/world/entity/ai/goal/RangedBowAttackGoal.java
+++ b/src/main/java/net/minecraft/world/entity/ai/goal/RangedBowAttackGoal.java
@@ -116,6 +116,7 @@ public class RangedBowAttackGoal<T extends Monster & RangedAttackMob> extends Go
                 }
 
                 this.mob.lookAt(livingEntity, 30.0F, 30.0F);
+                this.mob.getLookControl().setLookAt(this.mob.getTarget(), 30f, 30f); // CubePie - Implement Debugify
             } else {
                 this.mob.getLookControl().setLookAt(livingEntity, 30.0F, 30.0F);
             }
diff --git a/src/main/java/net/minecraft/world/entity/ai/goal/SwellGoal.java b/src/main/java/net/minecraft/world/entity/ai/goal/SwellGoal.java
index 137ec75ee803789deb7b1ca93dd9369c9af362b9..d6c60fb7f918d431035bbeeafe72b5894e1288ee 100644
--- a/src/main/java/net/minecraft/world/entity/ai/goal/SwellGoal.java
+++ b/src/main/java/net/minecraft/world/entity/ai/goal/SwellGoal.java
@@ -50,7 +50,7 @@ public class SwellGoal extends Goal {
             this.creeper.setSwellDir(-1);
         } else if (this.creeper.distanceToSqr(this.target) > 49.0) {
             this.creeper.setSwellDir(-1);
-        } else if (!this.creeper.getSensing().hasLineOfSight(this.target)) {
+        } else if (!this.creeper.getSensing().hasLineOfSight(this.target) && this.target.canBeSeenAsEnemy()) { // CubePie - Implement Debugify
             this.creeper.setSwellDir(-1);
         } else {
             this.creeper.setSwellDir(1);
diff --git a/src/main/java/net/minecraft/world/entity/animal/Animal.java b/src/main/java/net/minecraft/world/entity/animal/Animal.java
index 1808e1b01afa3041a54c9c9a7586d4d61960527a..b2c08eb071bc47e175239455eac7fd93b6332257 100644
--- a/src/main/java/net/minecraft/world/entity/animal/Animal.java
+++ b/src/main/java/net/minecraft/world/entity/animal/Animal.java
@@ -150,7 +150,15 @@ public abstract class Animal extends AgeableMob {
             if (!this.level().isClientSide && i == 0 && this.canFallInLove()) {
                 final ItemStack breedCopy = itemstack.copy(); // Paper - Fix EntityBreedEvent copying
                 this.usePlayerItem(player, hand, itemstack);
-                this.setInLove(player, breedCopy); // Paper - Fix EntityBreedEvent copying
+                // CubePie start - Implement Debugify
+                if(this instanceof Wolf wolf) {
+                    if(wolf.isTame()) {
+                        this.setInLove(player, breedCopy); // Paper - Fix EntityBreedEvent copying
+                    }
+                } else {
+                    this.setInLove(player, breedCopy); // Paper - Fix EntityBreedEvent copying
+                }
+                // CubePie end - Implement Debugify
                 return InteractionResult.SUCCESS;
             }
 
diff --git a/src/main/java/net/minecraft/world/entity/animal/Pufferfish.java b/src/main/java/net/minecraft/world/entity/animal/Pufferfish.java
index 3f0fad476fe573c3ba946a9436d1b3f7c5260ee2..93ab19a658916eea1ea42916f8d6a83870a76b0e 100644
--- a/src/main/java/net/minecraft/world/entity/animal/Pufferfish.java
+++ b/src/main/java/net/minecraft/world/entity/animal/Pufferfish.java
@@ -174,7 +174,7 @@ public class Pufferfish extends AbstractFish {
     public void playerTouch(Player player) {
         int i = this.getPuffState();
 
-        if (player instanceof ServerPlayer && i > 0 && player.hurt(this.damageSources().mobAttack(this), (float) (1 + i))) {
+        if (player instanceof ServerPlayer && i > 0 && player.hurt(this.damageSources().mobAttack(this), (float) (1 + i)) && this.isAlive()) { // CubePie - Implement Debugify
             if (!this.isSilent()) {
                 ((ServerPlayer) player).connection.send(new ClientboundGameEventPacket(ClientboundGameEventPacket.PUFFER_FISH_STING, 0.0F));
             }
diff --git a/src/main/java/net/minecraft/world/entity/boss/enderdragon/phases/DragonLandingPhase.java b/src/main/java/net/minecraft/world/entity/boss/enderdragon/phases/DragonLandingPhase.java
index 3b960060f152d0352c2f8cdc1c71543cd7fa0dbd..801e580184d4eff2627bb2cde73b6dc7cf7a3cae 100644
--- a/src/main/java/net/minecraft/world/entity/boss/enderdragon/phases/DragonLandingPhase.java
+++ b/src/main/java/net/minecraft/world/entity/boss/enderdragon/phases/DragonLandingPhase.java
@@ -1,6 +1,8 @@
 package net.minecraft.world.entity.boss.enderdragon.phases;
 
 import javax.annotation.Nullable;
+
+import net.minecraft.core.BlockPos;
 import net.minecraft.core.particles.ParticleTypes;
 import net.minecraft.util.RandomSource;
 import net.minecraft.world.entity.boss.enderdragon.EnderDragon;
@@ -40,9 +42,13 @@ public class DragonLandingPhase extends AbstractDragonPhaseInstance {
     @Override
     public void doServerTick() {
         if (this.targetLocation == null) {
-            this.targetLocation = Vec3.atBottomCenterOf(
-                this.dragon.level().getHeightmapPos(Heightmap.Types.MOTION_BLOCKING_NO_LEAVES, this.dragon.getPodium()) // Paper - Allow changing the EnderDragon podium
-            );
+            // CubePie start - Implement Debugify
+            BlockPos heightmapPos = this.dragon.level().getHeightmapPos(Heightmap.Types.MOTION_BLOCKING_NO_LEAVES, this.dragon.getPodium()); // Paper - Allow changing the EnderDragon podium
+            if(heightmapPos.getY() == 0)
+                heightmapPos.atY(65);
+
+            this.targetLocation = Vec3.atBottomCenterOf(heightmapPos);
+            // CubePie end - Implement Debugify
         }
 
         if (this.targetLocation.distanceToSqr(this.dragon.getX(), this.dragon.getY(), this.dragon.getZ()) < 1.0) {
diff --git a/src/main/java/net/minecraft/world/entity/decoration/ArmorStand.java b/src/main/java/net/minecraft/world/entity/decoration/ArmorStand.java
index c292f58ba4b29395484dbbf8591e455f449581d8..bbe82081363e761afce886658c88f01b9f14719a 100644
--- a/src/main/java/net/minecraft/world/entity/decoration/ArmorStand.java
+++ b/src/main/java/net/minecraft/world/entity/decoration/ArmorStand.java
@@ -507,7 +507,10 @@ public class ArmorStand extends LivingEntity {
                     if (source.is(DamageTypeTags.IS_EXPLOSION)) {
                         // Paper start - avoid duplicate event call
                         org.bukkit.event.entity.EntityDeathEvent event = this.brokenByAnything(worldserver, source);
-                        if (!event.isCancelled()) this.kill(source, false); // CraftBukkit
+                        if (!event.isCancelled()) {
+                            this.kill(source, false); // CraftBukkit
+                            this.showBreakingParticles(); // CubePie - Implement Debugify
+                        }
                         // Paper end
                         return false;
                     } else if (source.is(DamageTypeTags.IGNITES_ARMOR_STANDS)) {
@@ -608,7 +611,10 @@ public class ArmorStand extends LivingEntity {
         if (f1 <= 0.5F) {
             // Paper start - avoid duplicate event call
             org.bukkit.event.entity.EntityDeathEvent event = this.brokenByAnything(world, damageSource);
-            if (!event.isCancelled()) this.kill(damageSource, false); // CraftBukkit
+            if (!event.isCancelled()) {
+                this.kill(damageSource, false); // CraftBukkit
+                this.showBreakingParticles(); // CubePie - Implement Debugify
+            }
             // Paper end
         } else {
             this.setHealth(f1);
diff --git a/src/main/java/net/minecraft/world/entity/item/ItemEntity.java b/src/main/java/net/minecraft/world/entity/item/ItemEntity.java
index 4423973d4d9a2c3879d98d1d4c8b8c117c677ac5..6ceb5e4bb835da5fa4ec69d2b2ebe7c93779490c 100644
--- a/src/main/java/net/minecraft/world/entity/item/ItemEntity.java
+++ b/src/main/java/net/minecraft/world/entity/item/ItemEntity.java
@@ -17,11 +17,7 @@ import net.minecraft.tags.FluidTags;
 import net.minecraft.tags.ItemTags;
 import net.minecraft.util.Mth;
 import net.minecraft.world.damagesource.DamageSource;
-import net.minecraft.world.entity.Entity;
-import net.minecraft.world.entity.EntityType;
-import net.minecraft.world.entity.MoverType;
-import net.minecraft.world.entity.SlotAccess;
-import net.minecraft.world.entity.TraceableEntity;
+import net.minecraft.world.entity.*;
 import net.minecraft.world.item.Item;
 import net.minecraft.world.item.ItemStack;
 import net.minecraft.world.item.Items;
@@ -267,6 +263,14 @@ public class ItemEntity extends Entity implements TraceableEntity {
         return this.getOnPos(0.999999F);
     }
 
+    // CubePie start - Implement Debugify
+    @Override
+    public void thunderHit(ServerLevel world, LightningBolt lightning) {
+        if(tickCount <= 0) return;
+        super.thunderHit(world, lightning);
+    }
+    // CubePie end - Implement Debugify
+
     private void setUnderwaterMovement() {
         Vec3 vec3d = this.getDeltaMovement();
 
diff --git a/src/main/java/net/minecraft/world/entity/monster/Strider.java b/src/main/java/net/minecraft/world/entity/monster/Strider.java
index 2c5bfad3c1ae9a19b4762831a3abdd5e89ba24b3..92ece5a2d3a60636916a200ce474bc19250300cd 100644
--- a/src/main/java/net/minecraft/world/entity/monster/Strider.java
+++ b/src/main/java/net/minecraft/world/entity/monster/Strider.java
@@ -21,6 +21,7 @@ import net.minecraft.tags.FluidTags;
 import net.minecraft.tags.ItemTags;
 import net.minecraft.util.Mth;
 import net.minecraft.util.RandomSource;
+import net.minecraft.world.Difficulty;
 import net.minecraft.world.DifficultyInstance;
 import net.minecraft.world.InteractionHand;
 import net.minecraft.world.InteractionResult;
@@ -492,7 +493,7 @@ public class Strider extends Animal implements ItemSteerable, Saddleable {
         } else {
             RandomSource randomsource = world.getRandom();
 
-            if (randomsource.nextInt(30) == 0) {
+            if ((level().getDifficulty() == Difficulty.PEACEFUL ? 1 : randomsource.nextInt(30)) == 0) { // CubePie - Implement Debugify
                 Mob entityinsentient = (Mob) EntityType.ZOMBIFIED_PIGLIN.create(world.getLevel());
 
                 if (entityinsentient != null) {
diff --git a/src/main/java/net/minecraft/world/entity/monster/ZombieVillager.java b/src/main/java/net/minecraft/world/entity/monster/ZombieVillager.java
index e0dabbf6d7a87b8722769c78ef0d2ba4353ed2cb..132b8ac150aeabf3521a9703c5be7688429fdbf7 100644
--- a/src/main/java/net/minecraft/world/entity/monster/ZombieVillager.java
+++ b/src/main/java/net/minecraft/world/entity/monster/ZombieVillager.java
@@ -29,6 +29,7 @@ import net.minecraft.world.entity.MobSpawnType;
 import net.minecraft.world.entity.SlotAccess;
 import net.minecraft.world.entity.SpawnGroupData;
 import net.minecraft.world.entity.ai.village.ReputationEventType;
+import net.minecraft.world.entity.animal.Chicken;
 import net.minecraft.world.entity.npc.Villager;
 import net.minecraft.world.entity.npc.VillagerData;
 import net.minecraft.world.entity.npc.VillagerDataHolder;
@@ -283,6 +284,12 @@ public class ZombieVillager extends Zombie implements VillagerDataHolder {
             }
 
         }
+
+        // CubePie start - Implement Debugify
+        if (entityvillager.isPassenger() && entityvillager.getVehicle() instanceof Chicken && entityvillager.isBaby()) {
+            entityvillager.removeVehicle();
+        }
+        // CubePie end - Implement Debugify
     }
 
     private int getConversionProgress() {
diff --git a/src/main/java/net/minecraft/world/entity/projectile/FireworkRocketEntity.java b/src/main/java/net/minecraft/world/entity/projectile/FireworkRocketEntity.java
index 09d465947a5720e05c350d455c86002682104079..4d72a4ffe8de82413f11a1d5a0707659f0af1373 100644
--- a/src/main/java/net/minecraft/world/entity/projectile/FireworkRocketEntity.java
+++ b/src/main/java/net/minecraft/world/entity/projectile/FireworkRocketEntity.java
@@ -138,7 +138,7 @@ public class FireworkRocketEntity extends Projectile implements ItemSupplier {
             }
 
             if (this.attachedToEntity != null) {
-                if (this.attachedToEntity.isFallFlying()) {
+                if (this.attachedToEntity.isFallFlying() && !this.attachedToEntity.isSpectator()) { // CubePie - Implement Debugify
                     Vec3 vec3d1 = this.attachedToEntity.getLookAngle();
                     double d0 = 1.5D;
                     double d1 = 0.1D;
diff --git a/src/main/java/net/minecraft/world/entity/projectile/FishingHook.java b/src/main/java/net/minecraft/world/entity/projectile/FishingHook.java
index 1223c5d23d0ea6aed068bdf0f5725e2ad49fc82c..e6ffe677b5f075b15143da6b11f9004b39799742 100644
--- a/src/main/java/net/minecraft/world/entity/projectile/FishingHook.java
+++ b/src/main/java/net/minecraft/world/entity/projectile/FishingHook.java
@@ -24,10 +24,7 @@ import net.minecraft.tags.FluidTags;
 import net.minecraft.tags.ItemTags;
 import net.minecraft.util.Mth;
 import net.minecraft.util.RandomSource;
-import net.minecraft.world.entity.Entity;
-import net.minecraft.world.entity.EntityType;
-import net.minecraft.world.entity.ExperienceOrb;
-import net.minecraft.world.entity.MoverType;
+import net.minecraft.world.entity.*;
 import net.minecraft.world.entity.item.ItemEntity;
 import net.minecraft.world.item.ItemStack;
 import net.minecraft.world.item.Items;
@@ -613,6 +610,14 @@ public class FishingHook extends Projectile {
         if (entity1 != null) {
             Vec3 vec3d = (new Vec3(entity1.getX() - this.getX(), entity1.getY() - this.getY(), entity1.getZ() - this.getZ())).scale(0.1D);
 
+            // CubePie start - Implement Debugify
+            if (entity instanceof LivingEntity livingEntity) {
+                livingEntity.getCombatTracker().recordDamage(
+                    level().damageSources().thrown(this, getOwner()),
+                    livingEntity.getHealth()
+                );
+            }
+            // CubePie end - Implement Debugify
             entity.setDeltaMovement(entity.getDeltaMovement().add(vec3d));
         }
     }
diff --git a/src/main/java/net/minecraft/world/entity/vehicle/MinecartCommandBlock.java b/src/main/java/net/minecraft/world/entity/vehicle/MinecartCommandBlock.java
index 83ef2c3e7b06152b9e68f90002c35e77f148347d..8f326ed67e2b369ca9009fed8a712bf66f585129 100644
--- a/src/main/java/net/minecraft/world/entity/vehicle/MinecartCommandBlock.java
+++ b/src/main/java/net/minecraft/world/entity/vehicle/MinecartCommandBlock.java
@@ -54,12 +54,17 @@ public class MinecartCommandBlock extends AbstractMinecart {
         this.commandBlock.load(nbt, this.registryAccess());
         this.getEntityData().set(MinecartCommandBlock.DATA_ID_COMMAND_NAME, this.getCommandBlock().getCommand());
         this.getEntityData().set(MinecartCommandBlock.DATA_ID_LAST_OUTPUT, this.getCommandBlock().getLastOutput());
+        // CubePie start - Implement Debugify
+        if(nbt.contains("LastExecuted"))
+            this.lastActivated = nbt.getInt("LastExecuted");
+        // CubePie end - Implement Debugify
     }
 
     @Override
     protected void addAdditionalSaveData(CompoundTag nbt) {
         super.addAdditionalSaveData(nbt);
         this.commandBlock.save(nbt, this.registryAccess());
+        nbt.putInt("LastExecuted", this.lastActivated); // CubePie - Implement Debugify
     }
 
     @Override
diff --git a/src/main/java/net/minecraft/world/inventory/AbstractContainerMenu.java b/src/main/java/net/minecraft/world/inventory/AbstractContainerMenu.java
index dd4218e108f87f3305b76fbc8d88f488b447c609..1df99f4babf6adb8f363dbf6d83ae6218206ada4 100644
--- a/src/main/java/net/minecraft/world/inventory/AbstractContainerMenu.java
+++ b/src/main/java/net/minecraft/world/inventory/AbstractContainerMenu.java
@@ -30,6 +30,7 @@ import net.minecraft.world.entity.SlotAccess;
 import net.minecraft.world.entity.player.Inventory;
 import net.minecraft.world.entity.player.Player;
 import net.minecraft.world.flag.FeatureFlagSet;
+import net.minecraft.world.item.Item;
 import net.minecraft.world.item.ItemStack;
 import net.minecraft.world.level.block.Block;
 import net.minecraft.world.level.block.entity.BlockEntity;
@@ -647,6 +648,19 @@ public abstract class AbstractContainerMenu {
                         }
                     } else if (actionType == ClickType.THROW && this.getCarried().isEmpty() && slotIndex >= 0) {
                         slot2 = (Slot) this.slots.get(slotIndex);
+                        // CubePie start - Implement Debugify
+                        if (slot2.hasItem() && slot2.mayPickup(player) && slotIndex == 0 && button == 1) {
+                            Item item = slot2.getItem().getItem();
+
+                            while (slot2.hasItem() && slot2.getItem().getItem() == item) {
+                                this.doClick(slotIndex, 0, ClickType.THROW, player);
+                            }
+
+                            this.broadcastChanges();
+                            this.resetQuickCraft();
+                            return;
+                        }
+                        // CubePie end - Implement Debugify
                         k = button == 0 ? 1 : slot2.getItem().getCount();
                         itemstack = slot2.safeTake(k, Integer.MAX_VALUE, player);
                         player.drop(itemstack, true);
diff --git a/src/main/java/net/minecraft/world/level/block/CactusBlock.java b/src/main/java/net/minecraft/world/level/block/CactusBlock.java
index ff4dda48116a2969704b355ff96407ba869b466e..3409abd5dd2708530ae29931898d0127dd9c8dbe 100644
--- a/src/main/java/net/minecraft/world/level/block/CactusBlock.java
+++ b/src/main/java/net/minecraft/world/level/block/CactusBlock.java
@@ -13,6 +13,7 @@ import net.minecraft.world.level.BlockGetter;
 import net.minecraft.world.level.Level;
 import net.minecraft.world.level.LevelAccessor;
 import net.minecraft.world.level.LevelReader;
+import net.minecraft.world.level.block.piston.PistonMovingBlockEntity;
 import net.minecraft.world.level.block.state.BlockBehaviour;
 import net.minecraft.world.level.block.state.BlockState;
 import net.minecraft.world.level.block.state.StateDefinition;
@@ -108,6 +109,11 @@ public class CactusBlock extends Block {
         do {
             if (!iterator.hasNext()) {
                 BlockState iblockdata2 = world.getBlockState(pos.below());
+                // CubePie start - Implement Debugify
+                if (state.is(Blocks.MOVING_PISTON) && world.getBlockEntity(pos.below()) instanceof PistonMovingBlockEntity pistonBlock) {
+                    iblockdata2 = pistonBlock.getMovedState();
+                }
+                // CubePie end - Implement Debugify
 
                 return (iblockdata2.is(Blocks.CACTUS) || iblockdata2.is(BlockTags.SAND)) && !world.getBlockState(pos.above()).liquid();
             }
diff --git a/src/main/java/net/minecraft/world/level/block/FlowerPotBlock.java b/src/main/java/net/minecraft/world/level/block/FlowerPotBlock.java
index 7194565ad1a910fe300d8664a30b35c4eff18cb7..d7bcf06b10e37a54de1889d2ccea2f7d3aa603dc 100644
--- a/src/main/java/net/minecraft/world/level/block/FlowerPotBlock.java
+++ b/src/main/java/net/minecraft/world/level/block/FlowerPotBlock.java
@@ -78,6 +78,7 @@ public class FlowerPotBlock extends Block {
             world.setBlock(pos, blockState, 3);
             world.gameEvent(player, GameEvent.BLOCK_CHANGE, pos);
             player.awardStat(Stats.POT_FLOWER);
+            player.awardStat(Stats.ITEM_USED.get(player.getItemInHand(hand).getItem())); // CubePie - Implement Debugify
             stack.consume(1, player);
             return ItemInteractionResult.sidedSuccess(world.isClientSide);
         }
